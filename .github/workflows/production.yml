name: Music Player production

on:
    push:
        branches:
            - master

jobs:
    deploy:
        runs-on: ubuntu-latest

        steps:
            -   name: SSH into remote server and execute commands
                uses: appleboy/ssh-action@master
                with:
                    host: 103.148.57.174
                    username: root
                    key: ${{ secrets.SSH_PRIVATE_KEY }}
                    command_timeout: 20m
                    script: |
                        cd /root/music-player && \
                        echo "ğŸ“¥ Fetching latest code..." && \
                        git status && \
                        git reset --hard && \
                        git pull origin master && \
                        echo "ğŸ³ Rebuilding and restarting Docker containers..." && \
                        docker compose down && \
                        docker compose build --no-cache && \
                        docker compose up -d && \
                        echo "ğŸ§¹ Cleaning up unused Docker resources..." && \
                        docker system prune -f && \
                        echo "âœ… Deployment completed!" && \
                        echo "ğŸ“Š Container status:" && \
                        docker compose ps && \
                        echo "ğŸ“ Recent logs:" && \
                        docker compose logs --tail 20
